<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>Lá»‹ch sá»­ Ä‘Æ¡n hÃ ng</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>

<h1>ğŸ“¦ Lá»‹ch sá»­ Ä‘Æ¡n hÃ ng</h1>

<div style="text-align:center; margin-bottom:20px;">
    <button onclick="clearAllOrders()">ğŸ§¹ XÃ³a táº¥t cáº£ Ä‘Æ¡n hÃ ng</button>
</div>

<div id="orders"></div>

<div style="text-align:center; margin-top:30px;">
    <a href="index.html">â¬… Quay vá» trang chá»§</a>
</div>

<script>
function formatMoney(num) {
    return num.toLocaleString("vi-VN") + "Ä‘";
}

let orders = JSON.parse(localStorage.getItem("orders")) || [];
let ordersDiv = document.getElementById("orders");

/* ====== Cáº¬P NHáº¬T TRáº NG THÃI ====== */
function toggleStatus(index) {
    orders[index].status =
        orders[index].status === "done" ? "pending" : "done";

    localStorage.setItem("orders", JSON.stringify(orders));
    location.reload();
}

/* ====== XÃ“A 1 ÄÆ N ====== */
function deleteOrder(index) {
    if (!confirm("âŒ XÃ³a Ä‘Æ¡n nÃ y?")) return;
    orders.splice(index, 1);
    localStorage.setItem("orders", JSON.stringify(orders));
    location.reload();
}

/* ====== XÃ“A Táº¤T Cáº¢ ====== */
function clearAllOrders() {
    if (!confirm("âš ï¸ XÃ³a toÃ n bá»™ Ä‘Æ¡n hÃ ng?")) return;
    localStorage.removeItem("orders");
    location.reload();
}

/* ====== HIá»‚N THá»Š ====== */
if (orders.length === 0) {
    ordersDiv.innerHTML = "<p>âŒ ChÆ°a cÃ³ Ä‘Æ¡n hÃ ng nÃ o.</p>";
} else {
    let html = "";

    orders.slice().reverse().forEach((order, i) => {
        let realIndex = orders.length - 1 - i;
        let total = 0;
        let status = order.status || "pending";

        html += `
        <div class="order-box ${status}">
            <h3>
                ğŸ§¾ ÄÆ¡n #${realIndex + 1}
                <span class="status ${status}">
                    ${status === "done" ? "âœ… ÄÃ£ giao" : "ğŸŸ¡ ChÆ°a giao"}
                </span>
            </h3>

            <p><b>ğŸ‘¤ KhÃ¡ch:</b> ${order.ten}</p>
            <p><b>ğŸ“ SÄT:</b> ${order.sdt}</p>
            <p><b>ğŸ“ Äá»‹a chá»‰:</b> ${order.diaChi}</p>
            <p><b>ğŸ•’ Thá»i gian:</b> ${order.time}</p>
        `;

        if (order.ghiChu) {
            html += `<p><b>ğŸ“ Ghi chÃº:</b> ${order.ghiChu}</p>`;
        }

        html += `<ul>`;

        order.items.forEach(item => {
            let itemTotal = item.gia * item.qty;
            total += itemTotal;
            html += `<li>${item.ten} Ã— ${item.qty} = <b>${formatMoney(itemTotal)}</b></li>`;
        });

        html += `
            </ul>
            <p><b>ğŸ’° Tá»•ng tiá»n:</b> ${formatMoney(total)}</p>

            <button onclick="toggleStatus(${realIndex})">
                ğŸ” Äá»•i tráº¡ng thÃ¡i
            </button>
            <button onclick="deleteOrder(${realIndex})">
                ğŸ—‘ XÃ³a Ä‘Æ¡n
            </button>
        </div>
        `;
    });

    ordersDiv.innerHTML = html;
}
</script>

</body>
</html>
